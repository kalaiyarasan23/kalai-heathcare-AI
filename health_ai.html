<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalai ‚Äî Health Care AI Assistant (Single File Demo)</title>
  <meta name="description" content="Kalai ‚Äî AI healthcare assistant demo (single HTML file)."/>

  <style>
    :root{
      --primary:#0066cc;
      --accent:#00b8a9;
      --bg:#f4f8fb;
      --card:#ffffff;
      --muted:#6b7280;
      --radius:12px;
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f7fbff 0%, var(--bg) 100%);
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* Header / Nav */
    header{
      background: linear-gradient(90deg,var(--primary), #004f9e);
      color:white;
      padding:18px 20px;
      position:sticky;
      top:0;
      z-index:60;
      box-shadow: 0 6px 18px rgba(2,6,23,0.12);
      display:flex;
      align-items:center;
      gap:18px;
      justify-content:space-between;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo{
      width:48px;
      height:48px;
      border-radius:10px;
      background: radial-gradient(circle at 30% 30%, #00b8a9, var(--primary));
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 6px 18px rgba(2,6,23,0.18), inset 0 -6px 18px rgba(255,255,255,0.08);
      font-weight:700;
      color:white;
      font-size:18px;
      letter-spacing:0.6px;
    }
    header h1{ font-size:18px; margin:0; letter-spacing:0.2px; }
    nav a{
      color:rgba(255,255,255,0.95);
      text-decoration:none;
      margin-left:14px;
      font-weight:600;
    }
    .nav-right{ display:flex; align-items:center; gap:12px; }

    /* Main content */
    main{ max-width:1100px; margin:28px auto; padding:0 18px; width:100%; flex:1; }

    .hero{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      align-items:center;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:22px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.06);
      animation: fadeIn 0.5s ease both;
    }
    .hero .left h2{ margin:0 0 10px 0; font-size:26px; }
    .muted{ color:var(--muted); }

    .features{ display:grid; grid-template-columns: repeat(2,1fr); gap:12px; margin-top:14px; }
    .feature{ background:linear-gradient(180deg,#f8ffff, #ffffff); border-radius:10px; padding:12px; display:flex; gap:12px; align-items:flex-start; }

    .cta{ margin-top:14px; display:flex; gap:12px; align-items:center; }

    .btn{
      background:var(--accent);
      color:white;
      border:none;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn:hover{ transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.12); }

    /* Chat widget */
    #chatbot {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index:120;
      display:flex;
      gap:12px;
      align-items:flex-end;
      flex-direction:column;
    }
    #chat-window{
      width:360px;
      height:520px;
      display:flex;
      flex-direction:column;
      background: linear-gradient(180deg, rgba(255,255,255,0.98), #ffffff);
      border-radius:14px;
      overflow:hidden;
      box-shadow: 0 20px 60px rgba(2,6,23,0.18);
      transform-origin: bottom right;
      opacity:0;
      transform: translateY(20px) scale(.98);
      transition: all .28s cubic-bezier(.2,.9,.2,1);
    }
    #chat-window.open{
      opacity:1;
      transform: translateY(0) scale(1);
    }
    #chat-header{
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px;
      border-bottom:1px solid #eef2f6;
    }
    #chat-header .title{ font-weight:700; }
    #messages{
      flex:1;
      padding:14px;
      overflow:auto;
      background: linear-gradient(180deg, rgba(6,30,63,0.01), rgba(6,30,63,0.0));
    }
    .msg{ margin:8px 0; max-width:80%; display:inline-block; padding:10px 12px; border-radius:12px; line-height:1.3; }
    .msg.user{ background:#e1f5fe; margin-left:auto; border-bottom-right-radius:4px; }
    .msg.bot{ background:#d4fdd7; border-bottom-left-radius:4px; }

    #chat-controls{ display:flex; gap:8px; padding:10px; border-top:1px solid #eef2f6; }
    #chat-controls input{ flex:1; padding:10px; border-radius:10px; border:1px solid #e6eef6; outline:none; }
    .icon-btn{ background:var(--primary); color:white; border:none; width:46px; height:46px; display:flex; align-items:center; justify-content:center; border-radius:10px; cursor:pointer; font-size:18px; }

    /* Small chat bubble open button */
    #chat-toggle{
      width:64px;
      height:64px;
      border-radius:50%;
      background: linear-gradient(180deg,var(--primary), #0057b8);
      color:white;
      border:none;
      font-size:24px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.2);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
    }
    #status-badge{
      display:inline-block;
      padding:6px 10px;
      background: rgba(0,0,0,0.04);
      border-radius:999px;
      font-size:13px;
      color:var(--muted);
    }

    /* Login modal */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,0.4); display:none; align-items:center; justify-content:center; z-index:200; }
    .modal-backdrop.open{ display:flex; }
    .modal{ width:360px; border-radius:12px; padding:18px; background:linear-gradient(180deg,#fff,#fbfdff); box-shadow: 0 20px 60px rgba(2,6,23,0.28); }
    .modal h3{ margin:0 0 8px 0; }
    .field{ display:flex; flex-direction:column; gap:6px; margin-bottom:12px; }
    .field input{ padding:10px; border-radius:8px; border:1px solid #e6eef6; }

    /* Health records panel */
    #records-panel{ position:fixed; left:20px; bottom:20px; width:360px; z-index:110; }
    #records-panel .panel{ padding:12px; border-radius:12px; box-shadow: 0 12px 30px rgba(2,6,23,0.14); background:white; }
    .record{ border-left:3px solid var(--accent); padding:8px 12px; border-radius:8px; margin-bottom:8px; background:#fcfffe; }

    /* Responsive */
    @media (max-width:980px){
      .hero{ grid-template-columns: 1fr; }
      #chat-window{ width:320px; height:460px; }
      #records-panel{ display:none; }
    }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
    footer{ text-align:center; padding:18px; color:var(--muted); font-size:13px; }
  </style>
</head>
<body>

  <header>
    <div class="brand" aria-hidden="false">
      <div class="logo" title="Kalai logo">K</div>
      <div>
        <h1>Kalai Health Care</h1>
        <div style="font-size:13px; opacity:.95">AI Assistant ‚Ä¢ Smart health guidance</div>
      </div>
    </div>

    <div class="nav-right">
      <nav aria-label="Main navigation">
        <a href="#about">About</a>
        <a href="#features">Features</a>
        <a href="#chat">Chat</a>
      </nav>

      <div style="display:flex; align-items:center; gap:8px; margin-left:12px;">
        <div id="status-badge">Demo mode</div>
        <button class="btn" id="login-btn">Log in</button>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="card left">
        <h2 id="about" style="color:green;text-transform: uppercase;">Meet Kalai ‚Äî your healthcare AI</h2>
        <p class="muted">Symptom checking, medication reminders, mental wellness tips, and secure records ‚Äî all with a caring AI assistant. This UI  client-side  real AI features responses & persistence.</p>

        <div class="features" id="features" style="margin-top:16px;">
          <div class="feature">
            <div style="font-size:18px;">ü©∫</div>
            <div>
              <div style="font-weight:700">Symptom checker</div>
              <div class="muted" style="font-size:13px">Quick, explainable guidance ‚Äî not a diagnosis.</div>
            </div>
          </div>

          <div class="feature">
            <div style="font-size:18px;">üîî</div>
            <div>
              <div style="font-weight:700">Reminders & records</div>
              <div class="muted" style="font-size:13px">Store notes and health records locally or sync with a server.</div>
            </div>
          </div>

          <div class="feature">
            <div style="font-size:18px;">üó£Ô∏è</div>
            <div>
              <div style="font-weight:700">Voice assistant</div>
              <div class="muted" style="font-size:13px">Talk to Kalai with speech-to-text and hear replies.</div>
            </div>
          </div>

          <div class="feature">
            <div style="font-size:18px;">üîí</div>
            <div>
              <div style="font-weight:700">Privacy-minded</div>
              <div class="muted" style="font-size:13px">Client-side demo stores data locally. Use a secure backend and encryption for PHI.</div>
            </div>
          </div>
        </div>

        <div class="cta">
          <button class="btn" id="open-chat">Open Chat</button>
          <button class="btn" id="new-record">Add Health Record</button>
        </div>
      </div>

      <aside class="card" style="height:100%;">
        <h3 style="margin-top:0">Quick actions</h3>
        <p class="muted">Use these demo actions to explore the assistant and local records.</p>
        <div style="margin-top:12px;">
          <div style="display:flex; gap:8px;">
            <button class="btn" id="demo-symptom">Try: Fever</button>
            <button class="btn" id="demo-headache">Try: Headache</button>
          </div>
        </div>

        <div style="margin-top:16px;">
          <h4 style="margin:0 0 8px 0">Brand</h4>
          <p class="muted" style="font-size:13px">Colors and logo are set in the header. Replace the .logo block with your SVG for branding.</p>
        </div>
      </aside>
    </section>
  </main>

  <!-- Records panel (client-side store) -->
  <div id="records-panel" aria-hidden="false" style="margin-top: 150px;">
    <div class="panel card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
        <strong>My Health Records</strong>
        <small class="muted" id="record-count">0</small>
      </div>
      <div id="records-list" style="max-height:260px; overflow:auto"></div>
      <div style="margin-top:8px; display:flex; gap:8px;">
        <button class="btn" id="export-records">Export</button>
        <button class="btn" id="clear-records" style="background:#ff6b6b">Clear</button>
      </div>
    </div>
  </div>

  <!-- Chatbot -->
  <div id="chatbot" aria-live="polite">
    <div id="chat-window" role="dialog" aria-label="Kalai chat window">
      <div id="chat-header">
        <div style="display:flex; align-items:center; gap:8px;">
          <div style="width:40px; height:40px; border-radius:8px; background:linear-gradient(90deg,var(--accent), #007f7a); display:flex; align-items:center; justify-content:center; color:white; font-weight:700">K</div>
          <div>
            <div class="title">Kalai ‚Äî Health Assistant</div>
            <div class="muted" style="font-size:12px">Not a medical diagnosis. Use for guidance only.</div>
          </div>
        </div>
        <div style="margin-left:auto; display:flex; gap:8px;">
          <button id="btn-min" class="icon-btn" title="Minimize">‚Äî</button>
        </div>
      </div>

      <div id="messages" aria-live="polite">
        <!-- messages injected here -->
      </div>

      <div id="chat-controls">
        <button class="icon-btn" id="voice-btn" title="Start voice input">üéôÔ∏è</button>
        <input id="chat-input" placeholder="Describe symptoms, ask health questions..." aria-label="Message input" />
        <button class="btn" id="send-btn">Send</button>
      </div>
    </div>

    <button id="chat-toggle" aria-label="Open chat">üí¨</button>
  </div>

  <!-- Login modal -->
  <div class="modal-backdrop" id="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <h3>Log in to Kalai</h3>
      <p class="muted" style="font-size:13px">Demo login creates a local demo token. For production, replace with real auth.</p>
      <div class="field">
        <label>Email</label>
        <input id="email" type="email" placeholder="you@example.com" />
      </div>
      <div class="field">
        <label>Password</label>
        <input id="password" type="password" placeholder="password" />
      </div>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button class="btn" id="modal-close">Cancel</button>
        <button class="btn" id="modal-login">Log in</button>
      </div>
    </div>
  </div>

  <footer>
    ¬© Kalai Health Care ‚Äî Demo. For production/PHI, use a secure HIPAA/GDPR-compliant backend with encryption-at-rest.
  </footer>

  <script>
    /* =========================
         Client-side app state
       ========================= */
    const state = {
      open: false,
      listening: false,
      messages: [],
      token: localStorage.getItem('kalai_token') || null
    };

    // Elements
    const chatWindow = document.getElementById('chat-window');
    const chatToggle = document.getElementById('chat-toggle');
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const voiceBtn = document.getElementById('voice-btn');
    const btnMin = document.getElementById('btn-min');

    const loginBtn = document.getElementById('login-btn');
    const modalBackdrop = document.getElementById('modal-backdrop');
    const modalClose = document.getElementById('modal-close');
    const modalLogin = document.getElementById('modal-login');
    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');

    const recordsList = document.getElementById('records-list');
    const recordCount = document.getElementById('record-count');
    const newRecordBtn = document.getElementById('new-record');
    const exportBtn = document.getElementById('export-records');
    const clearBtn = document.getElementById('clear-records');

    // Demo quick buttons
    document.getElementById('open-chat').addEventListener('click', () => chatToggle.click());
    document.getElementById('demo-symptom').addEventListener('click', () => {
      setInputAndSend('I have fever and body aches since last night');
    });
    document.getElementById('demo-headache').addEventListener('click', () => {
      setInputAndSend('Severe headache and light sensitivity for 4 hours');
    });

    // Login modal handlers
    loginBtn.addEventListener('click', () => {
      modalBackdrop.classList.add('open');
      modalBackdrop.setAttribute('aria-hidden','false');
    });
    modalClose.addEventListener('click', () => closeModal());
    modalBackdrop.addEventListener('click', (e) => { if (e.target === modalBackdrop) closeModal(); });

    modalLogin.addEventListener('click', () => {
      const email = emailEl.value.trim() || 'demo@kalai.com';
      // Demo: generate a fake token and save
      const fakeToken = btoa(JSON.stringify({email, iat: Date.now()}));
      localStorage.setItem('kalai_token', fakeToken);
      state.token = fakeToken;
      alert('Logged in (demo). The app will try to use /api/chat when sending messages.');
      closeModal();
      updateLoginUI();
    });

    function closeModal(){
      modalBackdrop.classList.remove('open');
      modalBackdrop.setAttribute('aria-hidden','true');
    }

    function updateLoginUI(){
      if(state.token){
        loginBtn.textContent = 'Logged in';
        loginBtn.disabled = true;
      } else {
        loginBtn.textContent = 'Log in';
        loginBtn.disabled = false;
      }
    }
    updateLoginUI();

    /* =========================
         Chat UI & message flow
       ========================= */
    chatToggle.addEventListener('click', toggleChat);
    btnMin.addEventListener('click', toggleChat);

    function toggleChat(){
      state.open = !state.open;
      if(state.open){
        chatWindow.classList.add('open');
        chatToggle.style.transform = 'translateY(-6px)';
        // load initial greeting
        if(state.messages.length === 0){
          pushBot("Hello ‚Äî I'm Kalai, your AI health assistant. I can help with symptom guidance, record keeping, and reminders. How can I help today?");
        }
      } else {
        chatWindow.classList.remove('open');
        chatToggle.style.transform = 'none';
      }
    }

    function renderMessages(){
      messagesEl.innerHTML = '';
      for(const m of state.messages){
        const el = document.createElement('div');
        el.className = 'msg ' + (m.sender==='user' ? 'user' : 'bot');
        el.textContent = m.text;
        messagesEl.appendChild(el);
      }
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function pushUser(text){
      state.messages.push({sender:'user', text});
      renderMessages();
    }
    function pushBot(text){
      state.messages.push({sender:'bot', text});
      renderMessages();
      speakText(text); // TTS for bot replies
    }

    // Send button / Enter
    sendBtn.addEventListener('click', onSend);
    inputEl.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); onSend(); }
    });

    function onSend(){
      const text = inputEl.value.trim();
      if(!text) return;
      inputEl.value = '';
      pushUser(text);
      // If user logged-in and /api/chat exists, send to backend
      if(state.token){
        callBackendChat(text).then(reply => {
          pushBot(reply);
        }).catch(err => {
          console.warn('Backend chat failed, using fallback AI', err);
          pushBot(fallbackAiReply(text));
        });
      } else {
        // client-side fallback AI
        setTimeout(()=> pushBot(fallbackAiReply(text)), 500 + Math.random()*500);
      }
    }

    function setInputAndSend(text){
      inputEl.value = text;
      onSend();
    }

    /* =========================
         Fallback AI logic (simple & explainable)
       ========================= */
    function fallbackAiReply(text){
      const t = text.toLowerCase();
      if(/fever|temperature|chills/.test(t)){
        return "It sounds like you may have a fever. Stay hydrated, rest, and monitor your temperature. If your temperature is above 39¬∞C (102¬∞F), or you have trouble breathing, persistent vomiting, or altered mental state, seek urgent medical attention.";
      }
      if(/headache|migraine/.test(t)){
        return "For headaches: rest in a dark, quiet room, use OTC pain relief if appropriate (per label), and stay hydrated. If your headache is sudden and severe, or accompanied by weakness, vision changes, or confusion, seek immediate care.";
      }
      if(/covid|cough|sore throat|loss of taste/.test(t)){
        return "These symptoms can be associated with respiratory infections. Consider self-isolating, testing if recommended in your area, and monitoring symptoms. Seek care if you have difficulty breathing or persistent high fever.";
      }
      if(/prescription|take|medicine|dose/.test(t)){
        return "I can't prescribe medications. For accurate dosing and interactions, consult your prescribing clinician or pharmacist. If you want, I can look up general drug information (demo).";
      }
      // fallback ask for more details
      return "Can you tell me more about your symptoms (duration, severity, any medications or conditions)? I can give general guidance, but I'm not a substitute for a clinician.";
    }

    /* =========================
         Backend integration (optional)
       =========================
       To enable a real backend:
         - Host an API route POST /api/chat that accepts JSON: { message }
         - It should require header Authorization: Bearer <token> (we send state.token)
         - The endpoint should return JSON: { reply: "..." }
       IMPORTANT: Never expose your AI provider keys to the browser. The server must call OpenAI/Anthropic/etc.
    ========================= */
    async function callBackendChat(message){
      // This will fail in the demo unless you deploy a backend at the same origin
      const resp = await fetch('/api/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + state.token
        },
        body: JSON.stringify({message})
      });
      if(!resp.ok) throw new Error('Bad response from backend: ' + resp.status);
      const data = await resp.json();
      // expected: {reply: "..."} or {choices:[{text:"..."}]}
      return data.reply || data.choices?.[0]?.text || 'No reply from server';
    }

    /* =========================
         Web Speech API: STT & TTS
       ========================= */
    let recognition = null;
    if('SpeechRecognition' in window || 'webkitSpeechRecognition' in window){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SR();
      recognition.lang = 'en-IN';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.onresult = (e) => {
        const spoken = e.results[0][0].transcript;
        inputEl.value = spoken;
        // Auto-send after voice capture:
        onSend();
      };
      recognition.onend = () => {
        state.listening = false;
        voiceBtn.style.background = '';
      };
      recognition.onerror = (e) => {
        console.error('Speech recognition error', e);
        state.listening = false;
        voiceBtn.style.background = '';
      };
    } else {
      voiceBtn.title = 'Speech recognition not supported in this browser';
    }

    voiceBtn.addEventListener('click', () => {
      if(!recognition){
        alert('Speech recognition not supported in this browser (try Chrome).');
        return;
      }
      if(!state.listening){
        try {
          recognition.start();
          state.listening = true;
          voiceBtn.style.background = '#004f9e';
          voiceBtn.textContent = '‚è∫Ô∏è';
        } catch(e){
          console.warn('Could not start recognition', e);
        }
      } else {
        recognition.stop();
        state.listening = false;
        voiceBtn.style.background = '';
        voiceBtn.textContent = 'üéôÔ∏è';
      }
    });

    function speakText(text){
      if(!('speechSynthesis' in window)) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'en-IN';
      // optionally pick a voice:
      // utter.voice = speechSynthesis.getVoices().find(v => v.lang.startsWith('en')) || null;
      speechSynthesis.cancel(); // cancel other utterances
      speechSynthesis.speak(utter);
    }

    /* =========================
         Health Records (client-side storage)
       ========================= */
    function loadRecords(){
      try {
        const json = localStorage.getItem('kalai_records');
        const arr = json ? JSON.parse(json) : [];
        return arr;
      } catch(e){
        console.error('Failed to load records', e);
        return [];
      }
    }
    function saveRecords(arr){
      localStorage.setItem('kalai_records', JSON.stringify(arr));
    }
    function renderRecords(){
      const arr = loadRecords();
      recordsList.innerHTML = '';
      recordCount.textContent = arr.length;
      if(arr.length === 0){
        recordsList.innerHTML = '<div class="muted" style="font-size:13px">No records yet. Click "Add Health Record" to create one.</div>';
        return;
      }
      arr.slice().reverse().forEach((r) => {
        const el = document.createElement('div');
        el.className = 'record';
        el.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center;">
          <strong style="font-size:14px">${escapeHtml(r.title || 'Record')}</strong>
          <small class="muted" style="font-size:12px">${new Date(r.createdAt).toLocaleString()}</small>
        </div>
        <div style="margin-top:6px; font-size:13px">${escapeHtml(r.note || '')}</div>`;
        recordsList.appendChild(el);
      });
    }

    newRecordBtn.addEventListener('click', () => {
      const title = prompt('Title for record', 'Checkup note');
      if(!title) return;
      const note = prompt('Details (symptoms, meds, notes):', 'E.g., fever for 2 days');
      const arr = loadRecords();
      const r = { id: Date.now(), title, note, createdAt: new Date().toISOString() };
      arr.push(r);
      saveRecords(arr);
      renderRecords();
      alert('Record saved locally. For persistent storage, implement a backend /api/records POST endpoint and send records there while authenticated.');
    });

    exportBtn.addEventListener('click', () => {
      const arr = loadRecords();
      const blob = new Blob([JSON.stringify(arr, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'kalai-records.json'; a.click();
      URL.revokeObjectURL(url);
    });

    clearBtn.addEventListener('click', () => {
      if(confirm('Clear all local records? This cannot be undone.')) {
        localStorage.removeItem('kalai_records');
        renderRecords();
      }
    });

    // small helper
    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    /* =========================
         Init: load demo greeting & records
       ========================= */
    (function init(){
      state.messages = [];
      renderMessages();
      renderRecords();
      // show a small initial message to user on load (in console)
      console.log('Kalai single-file demo ready. To enable real AI, deploy a backend /api/chat and login.');
    })();

    /* =========================
         Optional: Add health-check send to backend
       ========================= */
    // (not called by default) Example:
    async function testBackend(){
      try {
        const r = await fetch('/api/health');
        console.log('backend health', r.status);
      } catch(e){
        console.warn('backend not available', e);
      }
    }

    /* =========================
         Small accessibility: focus input when chat opens
       ========================= */
    const obs = new MutationObserver(() => {
      if(chatWindow.classList.contains('open')) inputEl.focus();
    });
    obs.observe(chatWindow, { attributes: true });

    /* =========================
         Extra: Allow pressing "c" key to open chat (convenience)
       ========================= */
    document.addEventListener('keydown', e => {
      if(e.key === 'c' && (e.ctrlKey || e.metaKey)) {
        toggleChat();
        e.preventDefault();
      }
    });

  </script>
</body>
</html>